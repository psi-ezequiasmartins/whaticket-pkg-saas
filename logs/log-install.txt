
 💻 Instalando pm2...


added 1 package, and changed 135 packages in 8s

13 packages are looking for funding
  run `npm fund` for details
6.0.8

 💻 Instalando redis...

Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
ca-certificates is already the newest version (20240203~22.04.1).
curl is already the newest version (7.81.0-1ubuntu1.20).
software-properties-common is already the newest version (0.99.22.9).
software-properties-common set to manually installed.
apt-transport-https is already the newest version (2.4.14).
The following packages were automatically installed and are no longer required:
  libatasmart4 libblockdev-crypto2 libblockdev-fs2 libblockdev-loop2 libblockdev-part-err2
  libblockdev-part2 libblockdev-swap2 libblockdev-utils2 libblockdev2 libflashrom1 libftdi1-2
  libnuma1 libparted-fs-resize0 libudisks2-0 libvolume-key1
Use 'apt autoremove' to remove them.
0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).
OK
Repository: 'deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable'
Description:
Archive for codename: bionic components: stable
More info: https://download.docker.com/linux/ubuntu
Adding repository.
Adding deb entry to /etc/apt/sources.list.d/archive_uri-https_download_docker_com_linux_ubuntu-jammy.list
Adding disabled deb-src entry to /etc/apt/sources.list.d/archive_uri-https_download_docker_com_linux_ubuntu-jammy.list
Hit:1 http://apt.postgresql.org/pub/repos/apt jammy-pgdg InRelease
Hit:2 http://archive.canonical.com/ubuntu jammy InRelease
Get:3 https://download.docker.com/linux/ubuntu bionic InRelease [64.4 kB]
Hit:4 https://deb.nodesource.com/node_22.x nodistro InRelease
Hit:5 http://archive.ubuntu.com/ubuntu jammy InRelease
Hit:6 http://archive.ubuntu.com/ubuntu jammy-updates InRelease
Hit:7 http://archive.ubuntu.com/ubuntu jammy-security InRelease
Get:8 https://download.docker.com/linux/ubuntu bionic/stable amd64 Packages [39.0 kB]
Hit:9 http://archive.ubuntu.com/ubuntu jammy-backports InRelease
Fetched 103 kB in 1s (102 kB/s)
Reading package lists... Done
W: http://apt.postgresql.org/pub/repos/apt/dists/jammy-pgdg/InRelease: Key is stored in legacy trusted.gpg keyring (/etc/apt/trusted.gpg), see the DEPRECATION section in apt-key(8) for details.
W: https://download.docker.com/linux/ubuntu/dists/bionic/InRelease: Key is stored in legacy trusted.gpg keyring (/etc/apt/trusted.gpg), see the DEPRECATION section in apt-key(8) for details.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  bridge-utils dns-root-data dnsmasq-base libatasmart4 libblockdev-crypto2 libblockdev-fs2
Unpacking libslirp0:amd64 (4.6.1-1build1) ...
Selecting previously unselected package slirp4netns.
Preparing to unpack .../8-slirp4netns_1.0.1-2_amd64.deb ...
Unpacking slirp4netns (1.0.1-2) ...
Setting up docker-buildx-plugin (0.10.5-1~ubuntu.18.04~bionic) ...
Setting up containerd.io (1.6.21-1) ...
Setting up docker-compose-plugin (2.18.1-1~ubuntu.18.04~bionic) ...
Setting up libltdl7:amd64 (2.4.6-15build2) ...
Setting up docker-ce-cli (5:24.0.2-1~ubuntu.18.04~bionic) ...
Setting up libslirp0:amd64 (4.6.1-1build1) ...
Setting up docker-ce-rootless-extras (5:24.0.2-1~ubuntu.18.04~bionic) ...
Setting up slirp4netns (1.0.1-2) ...
Setting up docker-ce (5:24.0.2-1~ubuntu.18.04~bionic) ...
Job for docker.service failed because the control process exited with error code.
See "systemctl status docker.service" and "journalctl -xeu docker.service" for details.
invoke-rc.d: initscript docker, action "start" failed.
● docker.service - Docker Application Container Engine
     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
     Active: activating (auto-restart) (Result: exit-code) since Sat 2025-06-07 15:17:14 -03; 9ms ago
TriggeredBy: ● docker.socket
       Docs: https://docs.docker.com
    Process: 32975 ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock (code=exited, status=1/FAILURE)
   Main PID: 32975 (code=exited, status=1/FAILURE)
        CPU: 79ms
dpkg: error processing package docker-ce (--configure):
 installed docker-ce package post-installation script subprocess returned error exit status 1
Processing triggers for man-db (2.10.2-1) ...
Processing triggers for libc-bin (2.35-0ubuntu3.10) ...
Errors were encountered while processing:
 docker-ce
needrestart is being skipped since dpkg has failed
E: Sub-process /usr/bin/dpkg returned an error code (1)

 💻 Instalando snapd...

Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
snapd is already the newest version (2.67.1+22.04).
snapd set to manually installed.
The following packages were automatically installed and are no longer required:
  bridge-utils dns-root-data dnsmasq-base libatasmart4 libblockdev-crypto2 libblockdev-fs2
  libblockdev-loop2 libblockdev-part-err2 libblockdev-part2 libblockdev-swap2 libblockdev-utils2
  libblockdev2 libflashrom1 libftdi1-2 libnuma1 libparted-fs-resize0 libudisks2-0 libvolume-key1
  ubuntu-fan
Use 'apt autoremove' to remove them.
0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
1 not fully installed or removed.
After this operation, 0 B of additional disk space will be used.
Setting up docker-ce (5:24.0.2-1~ubuntu.18.04~bionic) ...
Scanning processes...
Scanning linux images...

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
core 16-2.61.4-20241002 from Canonical✓ installed
WARNING: There is 1 new warning. See 'snap warnings'.
snap "core" has no updates available

 💻 Instalando nginx...

Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
nginx is already the newest version (1.18.0-6ubuntu14.6).
The following packages were automatically installed and are no longer required:
  bridge-utils dns-root-data dnsmasq-base libatasmart4 libblockdev-crypto2 libblockdev-fs2
  libblockdev-loop2 libblockdev-part-err2 libblockdev-part2 libblockdev-swap2 libblockdev-utils2
  libblockdev2 libflashrom1 libftdi1-2 libnuma1 libparted-fs-resize0 libudisks2-0 libvolume-key1
  ubuntu-fan
Use 'apt autoremove' to remove them.
0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
🔄 Instalando/Atualizando snapd e certbot...
snap "core" is already installed, see 'snap help refresh'
certbot 4.0.0 from Certbot Project (certbot-eff✓) installed
WARNING: There is 1 new warning. See 'snap warnings'.
✅ Certbot instalado.

 💻 Agora, vamos criar o usuário para whaticketsaas...

Usuário 'deploy' já existe. Pulando criação.
✅ Serviço snapd está ativo.
✅ Serviço nginx está ativo.
✅ Serviço docker está ativo.

 💻 Agora, vamos criar a nova pasta...

 💻 Fazendo download do código Whaticket...

Cloning into '/home/deploy/nexus'...
remote: Enumerating objects: 1323, done.
remote: Counting objects: 100% (1323/1323), done.
remote: Compressing objects: 100% (790/790), done.
remote: Total 1323 (delta 364), reused 1305 (delta 346), pack-reused 0 (from 0)
Receiving objects: 100% (1323/1323), 4.91 MiB | 14.67 MiB/s, done.
Resolving deltas: 100% (364/364), done.

 💻 Fazendo unzip whaticket...

unzip:  cannot find or open /home/deploy/nexus/whaticket.zip, /home/deploy/nexus/whaticket.zip.zip or /home/deploy/nexus/whaticket.zip.ZIP.
sleep: missing operand
Try 'sleep --help' for more information.

 💻 Criando Redis & Banco Postgres...

411a8f2e4ea14305bef43f31354b99e74e79b04f7e922c59e665ab7a2268b100
CREATE ROLE
ALTER ROLE

 💻 Instalando dependências do backend...

npm error code EACCES
npm error syscall mkdir
npm error path /home/deploy/nexus/backend/node_modules
npm error errno -13
npm error Error: EACCES: permission denied, mkdir '/home/deploy/nexus/backend/node_modules'
npm error     at async mkdir (node:internal/fs/promises:852:10)
npm error     at async /usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/reify.js:638:20
npm error     at async Promise.allSettled (index 0)
npm error     at async [reifyPackages] (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/reify.js:336:11)
npm error     at async Arborist.reify (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/reify.js:141:5)
npm error     at async Install.exec (/usr/lib/node_modules/npm/lib/commands/install.js:149:5)
npm error     at async Npm.exec (/usr/lib/node_modules/npm/lib/npm.js:208:9)
npm error     at async module.exports (/usr/lib/node_modules/npm/lib/cli/entry.js:67:5) {
npm error   errno: -13,
npm error   code: 'EACCES',
npm error   syscall: 'mkdir',
npm error   path: '/home/deploy/nexus/backend/node_modules'
npm error }
npm error
npm error The operation was rejected by your operating system.
npm error It is likely you do not have the permissions to access this file as the current user
npm error
npm error If you believe this might be a permissions issue, please double-check the
npm error permissions of the file and its containing directories, or try running
npm error the command again as root/Administrator.
npm error A complete log of this run can be found in: /home/deploy/.npm/_logs/2025-06-07T18_18_45_734Z-debug-0.log

 💻 Compilando o código do backend...

> backend@1.0.0 build
> tsc --sourceMap false

sh: 1: tsc: not found

 💻 Executando db:seed...

npm error could not determine executable to run
npm error A complete log of this run can be found in: /home/deploy/.npm/_logs/2025-06-07T18_19_59_093Z-debug-0.log

 💻 Iniciando pm2 (backend)...

[PM2][ERROR] Script not found: /home/deploy/nexus/backend/dist/server.js
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2

 💻 Configurando nginx (backend)...

 💻 Configurando variáveis de ambiente (frontend)...

-bash: line 1: /home/deploy/nexus/frontend/.env: Permission denied
-bash: line 1: /home/deploy/nexus/frontend/server.js: Permission denied

 💻 Instalando dependências do frontend...

npm warn using --force Recommended protections disabled.
npm warn ERESOLVE overriding peer dependency
npm warn While resolving: react-redux@5.1.2
npm warn Found: react@17.0.2
npm warn node_modules/react
npm warn   react@"^17.0.2" from the root project
npm warn   65 more (@emotion/react, @emotion/styled, ...)
npm warn
npm warn Could not resolve dependency:
npm warn peer react@"^0.14.0 || ^15.0.0-0 || ^16.0.0-0" from react-redux@5.1.2
npm warn node_modules/react-trello/node_modules/react-redux
npm warn   react-redux@"^5.0.7" from react-trello@2.2.11
npm warn   node_modules/react-trello
npm warn
npm warn Conflicting peer dependency: react@16.14.0
npm warn node_modules/react
npm warn   peer react@"^0.14.0 || ^15.0.0-0 || ^16.0.0-0" from react-redux@5.1.2
npm warn   node_modules/react-trello/node_modules/react-redux
npm warn     react-redux@"^5.0.7" from react-trello@2.2.11
npm warn     node_modules/react-trello
npm error code EACCES
npm error syscall mkdir
npm error path /home/deploy/nexus/frontend/node_modules
npm error errno -13
npm error Error: EACCES: permission denied, mkdir '/home/deploy/nexus/frontend/node_modules'
npm error     at async mkdir (node:internal/fs/promises:852:10)
npm error     at async /usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/reify.js:638:20
npm error     at async Promise.allSettled (index 0)
npm error     at async [reifyPackages] (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/reify.js:336:11)
npm error     at async Arborist.reify (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/reify.js:141:5)
npm error     at async Install.exec (/usr/lib/node_modules/npm/lib/commands/install.js:149:5)
npm error     at async Npm.exec (/usr/lib/node_modules/npm/lib/npm.js:208:9)
npm error     at async module.exports (/usr/lib/node_modules/npm/lib/cli/entry.js:67:5) {
npm error   errno: -13,
npm error   code: 'EACCES',
npm error   syscall: 'mkdir',
npm error   path: '/home/deploy/nexus/frontend/node_modules'
npm error }
npm error
npm error The operation was rejected by your operating system.
npm error It is likely you do not have the permissions to access this file as the current user
npm error
npm error If you believe this might be a permissions issue, please double-check the
npm error permissions of the file and its containing directories, or try running
npm error the command again as root/Administrator.
npm error A complete log of this run can be found in: /home/deploy/.npm/_logs/2025-06-07T18_20_18_433Z-debug-0.log

 💻 Compilando o código do frontend...


> frontend@0.1.0 build
> export NODE_OPTIONS="--max-old-space-size=8192" && NODE_OPTIONS=--openssl-legacy-provider GENERATE_SOURCEMAP=false react-scripts build

sh: 1: react-scripts: not found


 💻 Iniciando pm2 (frontend)...

[PM2] Starting /home/deploy/nexus/frontend/server.js in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ nexus-frontend     │ fork     │ 0    │ online    │ 0%       │ 32.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
[PM2] Init System found: systemd
Platform systemd
Template
[Unit]
Description=PM2 process manager
Documentation=https://pm2.keymetrics.io/
After=network.target

[Service]
Type=forking
User=root
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
Environment=PM2_HOME=/root/.pm2
PIDFile=/root/.pm2/pm2.pid
Restart=on-failure

ExecStart=/usr/lib/node_modules/pm2/bin/pm2 resurrect
ExecReload=/usr/lib/node_modules/pm2/bin/pm2 reload all
ExecStop=/usr/lib/node_modules/pm2/bin/pm2 kill

[Install]
WantedBy=multi-user.target

Target path
/etc/systemd/system/pm2-root.service
Command list
[ 'systemctl enable pm2-root' ]
[PM2] Writing init configuration in /etc/systemd/system/pm2-root.service
[PM2] Making script booting at startup...
[PM2] [-] Executing: systemctl enable pm2-root...
Created symlink /etc/systemd/system/multi-user.target.wants/pm2-root.service → /etc/systemd/system/pm2-root.service.
[PM2] [v] Command successfully executed.
+---------------------------------------+
[PM2] Freeze a process list on reboot via:
$ pm2 save

[PM2] Remove init script via:
$ pm2 unstartup systemd
[PM2] Init System found: systemd
Platform systemd
Template
[Unit]
Description=PM2 process manager
Documentation=https://pm2.keymetrics.io/
After=network.target

[Service]
Type=forking
User=deploy
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
Environment=PM2_HOME=/home/deploy/.pm2
PIDFile=/home/deploy/.pm2/pm2.pid
Restart=on-failure

ExecStart=/usr/lib/node_modules/pm2/bin/pm2 resurrect
ExecReload=/usr/lib/node_modules/pm2/bin/pm2 reload all
ExecStop=/usr/lib/node_modules/pm2/bin/pm2 kill

[Install]
WantedBy=multi-user.target

Target path
/etc/systemd/system/pm2-deploy.service
Command list
[ 'systemctl enable pm2-deploy' ]
[PM2] Writing init configuration in /etc/systemd/system/pm2-deploy.service
[PM2] Making script booting at startup...
[PM2] [-] Executing: systemctl enable pm2-deploy...
Created symlink /etc/systemd/system/multi-user.target.wants/pm2-deploy.service → /etc/systemd/system/pm2-deploy.service.
[PM2] [v] Command successfully executed.
+---------------------------------------+
[PM2] Freeze a process list on reboot via:
$ pm2 save

[PM2] Remove init script via:
$ pm2 unstartup systemd

 💻 Configurando nginx (frontend)...


 💻 configurando nginx...


 💻 reiniciando nginx...

Job for nginx.service failed because the control process exited with error code.
See "systemctl status nginx.service" and "journalctl -xeu nginx.service" for details.

 💻 Configurando certbot...

Saving debug log to /var/log/letsencrypt/letsencrypt.log
The requested nginx plugin does not appear to be installed
root@ubuntu:/www/wwwroot#